{
  "branch": "brevo-integration",
  "tests": [
    {
      "id": "brevo-backfill-creates-contacts-and-companies",
      "category": "Startup Backfill",
      "description": "Backfill creates Brevo contacts and companies for all orgs",
      "setup": "Verify all organizations have a non-NULL brevo_company_id in the database, confirming the startup backfill has completed.",
      "steps": [
        "In Brevo dashboard, go to Contacts and verify each org owner appears with correct attributes (SCANOPY_USER_ID, FIRSTNAME, LASTNAME, SCANOPY_LAST_LOGIN_DATE)",
        "Go to Companies and verify each org has a company with correct attributes (scanopy_org_id, scanopy_plan_type, entity counts)",
        "Click a company and verify the owner contact is linked to it"
      ],
      "expected": "Each organization's owner exists as a Brevo contact with correct attributes including SCANOPY_LAST_LOGIN_DATE set to signup time. Each org has a corresponding company with matching attributes. Contact is linked to company.",
      "status": null,
      "feedback": null
    },
    {
      "id": "brevo-login-updates-last-login",
      "category": "Event Handling",
      "description": "Login event updates contact's last login date in Brevo",
      "setup": "Verify the test user's org has a non-NULL brevo_company_id in the database.",
      "steps": [
        "Log in to Scanopy as the test user",
        "In Brevo dashboard, check the contact's SCANOPY_LAST_LOGIN_DATE attribute"
      ],
      "expected": "Contact's SCANOPY_LAST_LOGIN_DATE is updated to approximately the current login timestamp.",
      "status": null,
      "feedback": null
    },
    {
      "id": "brevo-entity-metrics-sync",
      "category": "Event Handling",
      "description": "Creating/deleting entities updates company metrics in Brevo",
      "setup": "Verify the test org has a non-NULL brevo_company_id in the database. Note the current scanopy_network_count and scanopy_host_count on the company in Brevo.",
      "steps": [
        "In Scanopy, create a new network",
        "In Brevo, verify the company's scanopy_network_count increased by 1",
        "In Scanopy, create a host on the new network",
        "In Brevo, verify scanopy_host_count increased by 1",
        "In Scanopy, delete the host",
        "In Brevo, verify scanopy_host_count decreased by 1"
      ],
      "expected": "Company attributes (scanopy_network_count, scanopy_host_count) reflect current DB counts after each change. Updates may be debounced by up to 5 seconds.",
      "status": null,
      "feedback": null
    },
    {
      "id": "brevo-enterprise-inquiry-happy-path",
      "category": "Enterprise Inquiry",
      "description": "Submitting enterprise inquiry creates a deal in Brevo and tracks event",
      "setup": "Verify the test user's org has a non-NULL brevo_company_id in the database.",
      "steps": [
        "In Scanopy, navigate to Settings > Billing",
        "Open the enterprise inquiry modal",
        "Fill in all fields (company name, team size, use case, message, urgency, network count)",
        "Submit the form",
        "In Brevo, go to Deals and verify a new deal named 'Enterprise Inquiry - <company>' was created in the Sales pipeline",
        "Click the deal and verify it has the correct attributes (team_size, message, plan_type, urgency, network_count)",
        "Verify the deal is linked to the org's company",
        "In Brevo, check for an enterprise_inquiry event on the contact"
      ],
      "expected": "Form submits successfully with no errors. A new deal is created in the Sales pipeline with all inquiry fields as deal attributes, linked to the org's Brevo company. enterprise_inquiry event tracked with full details.",
      "status": null,
      "feedback": null
    },
    {
      "id": "brevo-cookie-consent-with-brevo",
      "category": "Frontend Cleanup",
      "description": "Cookie consent banner appears when Brevo is configured",
      "steps": [
        "Clear all cookies for the Scanopy app",
        "Load the app in a browser",
        "Verify the cookie consent banner appears"
      ],
      "expected": "Cookie consent banner is displayed to new visitors when SCANOPY_BREVO_API_KEY is configured.",
      "status": null,
      "feedback": null
    }
  ]
}
